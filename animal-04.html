<!DOCTYPE html>
<html>
    <head>
        <script src="https://unpkg.com/konva@4.2.2/konva.min.js"></script>
        <meta charset="utf-8" />
        <title>Konva Animals on the Beach Game Demo</title>
        <style>
            body {
                margin: 0;
                padding: 0;
                overflow: hidden;
                background-color: #ee00f7;
            }
        </style>
    </head>
    <body>
        <div id="container"></div>
        <script>
            var bkimage = "beach"
            var animals = [ "monkey", "lion", "giraffe", "snake"]
            var paths = {
                monkey: { sx:275 , sy:70 , ex:300 , ey:420 },
                lion::{ sx:400, sy:70, ex:100, ey:390 },
                giraffe: { sx:90 , sy:70 , ex:390 , ey:250 },
                snake: { sx:10 , sy:70 , ex:275 , ey:350 },
            }
            var loadedImages = 0;

            loadedImages(bkimage, animals, initStage)

            function loadedImages(bgimg, fgimgs, callback){
                var assetDir = 'asset/';
                var variants = ["", "_black", "_glow"];
                var images = {};
                var sources = [bgimg]
                for( var i = 0; i< fgimgs.length; i++){
                    for(var j = 0; j < variants.length; j++){
                        sources.push(fgimgs[i] + variants[j])
                    }
                }
                var numImages = sources.length;
                //console.log("numImages",numImages); 在網頁上F12能看結果
                for (var i = 0; i< sources.length; i++){
                    var src = sources[i];
                    images[src] = new Image();
                    images[src].src = assetDir + src + ".png";
                    images[src].onload = function(){
                        if(++loadedImages >= numImages){
                            callback(images);
                        }
                    };
                };
                //console.log("images",images)
            }

            var stage = new Konva.Stage({
                container: 'container',
                width: 578,
                height: 530,
            });
            var background = new Konva.Layer();
            stage.add(background)

            var bkimage = new Image();
            bkimage.src = 'assets/beach.png';
            bkimage.onload = function () {
                var context = background.getContext()
                context.drawImage(bkimage, 0, 0);
            };

            var animalLayer = new Konva.Layer();
            var monkeyPos = { x: 50, y: 0 }
            var monkey = new Image()
            monkey.src = 'assets/monkey.png';
            monkey.onload = function(){
                var monkeyImg = new Konva.Image({
                    image: monkey ,
                    x: monkeyPos.x ,
                    y: monkeyPos.y ,
                });
                animalLayer.add(monkeyImg)
                stage.add(animalLayer)
            };
            
        </script>
    </body>
</html>